## 1. 修复 Supabase 配置问题

- [ ] 1.1 更新 SUPABASE_SECRET_KEY
  - [ ] 1.1.1 获取正确的 service_role 密钥
  - [ ] 1.1.2 更新 .env 文件中的配置
  - [ ] 1.1.3 验证密钥权限和类型

- [ ] 1.2 验证 Supabase 连接
  - [ ] 1.2.1 测试新的密钥连接
  - [ ] 1.2.2 验证表的访问权限
  - [ ] 1.2.3 确认可以执行写入操作

## 2. 运行数据库迁移

- [ ] 2.1 检查当前数据库状态
  - [ ] 2.1.1 连接到 Supabase 数据库
  - [ ] 2.1.2 列出当前表结构
  - [ ] 2.1.3 识别缺失的列或表

- [ ] 2.2 执行必要的迁移
  - [ ] 2.2.1 运行 task_steps 表迁移
  - [ ] 2.2.2 运行 step_screenshots 表迁移
  - [ ] 2.2.3 验证外键约束正确设置
  - [ ] 2.2.4 运行扩展 tasks 表的迁移

- [ ] 2.3 验证迁移结果
  - [ ] 2.3.1 检查所有表是否存在
  - [ ] 2.3.2 验证列定义正确
  - [ ] 2.3.3 测试插入操作

## 3. 修复 Web 应用逻辑

- [ ] 3.1 修正 SUPABASE_AVAILABLE 检测
  - [ ] 3.1.1 修复 supabase_manager.py 中的导入问题
  - [ ] 3.1.2 确保正确检测 Supabase 可用性
  - [ ] 3.1.3 添加更好的错误处理

- [ ] 3.2 增强错误处理
  - [ ] 3.2.1 添加详细的数据库保存错误日志
  - [ ] 3.2.2 实现重试机制处理临时错误
  - [ ] 3.2.3 确保数据库保存失败不影响任务执行

## 4. 测试和验证

- [ ] 4.1 端到端测试
  - [ ] 4.1.1 执行一个完整任务
  - [ ] 4.1.2 验证步骤保存到 task_steps 表
  - [ ] 4.1.3 验证截图保存到 step_screenshots 表
  - [ ] 4.1.4 检查数据完整性

- [ ] 4.2 错误场景测试
  - [ ] 4.2.1 测试数据库连接失败的处理
  - [ ] 4.2.2 测试权限不足的处理
  - [ ] 4.2.3 测试表不存在的处理

- [ ] 4.3 性能验证
  - [ ] 4.3.1 检查数据库保存不影响任务性能
  - [ ] 4.3.2 验证批量操作效率
  - [ ] 4.3.3 确认内存使用合理

## 5. 文档和部署

- [ ] 5.1 更新配置文档
  - [ ] 5.1.1 更新 .env 文件模板
  - [ ] 5.1.2 添加密钥获取说明
  - [ ] 5.1.3 记录迁移步骤

- [ ] 5.2 创建部署指南
  - [ ] 5.2.1 新安装的数据库设置步骤
  - [ ] 5.2.2 现有实例的升级步骤
  - [ ] 5.2.3 故障排除指南

## 6. 回归测试

- [ ] 6.1 验证现有功能
  - [ ] 6.1.1 确认任务管理功能正常
  - [ ] 6.1.2 验证脚本录制功能不受影响
  - [ ] 6.1.3 测试 Web 界面所有功能

- [ ] 6.2 集成测试
  - [ ] 6.2.1 测试完整的任务执行流程
  - [ ] 6.2.2 验证实时更新功能
  - [ ] 6.2.3 确认报告生成正常