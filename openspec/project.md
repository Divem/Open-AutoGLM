# Project Context

## Purpose
Open-AutoGLM 是一个基于 AI 的手机自动化框架，能够让用户通过自然语言指令自动操作 Android 设备。项目的主要目标是：
- 提供直观的自然语言界面，让用户无需编程即可实现手机自动化
- 支持超过 50 个主流中文应用（微信、淘宝、抖音、小红书等）
- 实现智能的视觉感知和操作决策能力
- 提供现代化的 Web 界面和命令行工具
- 支持脚本记录与重放，便于任务复现和调试

## Tech Stack

### Backend Technologies
- **Python 3.10+** - 主要开发语言
- **Flask 2.3.3** - Web 框架，提供 API 服务
- **Flask-SocketIO 5.3.6** - WebSocket 支持，实现实时通信
- **Pillow >=12.0.0** - 图像处理和屏幕截图处理
- **OpenAI >=2.9.0** - AI 模型客户端，支持 OpenAI 兼容 API

### Frontend Technologies
- **HTML5/CSS3/JavaScript** - Web 界面开发
- **WebSocket** - 实时数据推送和双向通信
- **Bootstrap/现代 CSS** - 响应式界面设计

### Data Storage
- **Supabase** - 云端 PostgreSQL 数据库，用于任务持久化
- **本地文件存储** - Pickle 文件作为备选存储方案

### Device Control
- **ADB (Android Debug Bridge)** - Android 设备控制和通信
- **ADB Keyboard** - 文本输入解决方案

### AI Models
- **AutoGLM-Phone-9B** - 专门为手机操作优化的多模态大语言模型
- **智谱 BigModel API** - 云端 AI 服务
- **ModelScope API** - 备选云端 AI 服务
- **本地部署支持** - vLLM/SGLang 本地模型部署

## Project Conventions

### Code Style
- 遵循 **PEP 8** Python 代码规范
- 使用 **Python 3.10+** 类型注解提高代码可读性
- 采用 **dataclass** 定义配置类和数据结构
- 使用 **模块化设计**，确保职责分离和高内聚低耦合
- 函数和类使用描述性命名，遵循 snake_case 和 PascalCase 约定
- 注释使用中文，提高中文开发团队的代码可维护性

### Architecture Patterns
- **分层架构**：Web界面层 → 业务逻辑层 → 设备控制层 → AI模型层
- **模块化设计**：phone_agent 核心引擎 + web 界面 + 配置管理
- **事件驱动**：使用 WebSocket 实现实时状态更新和用户交互
- **策略模式**：支持多种 AI 模型提供商和部署方式
- **适配器模式**：统一的设备控制接口，支持不同连接方式
- **观察者模式**：任务状态变化通知和日志记录

### Testing Strategy
- **集成测试优先**：重点测试完整的任务执行流程
- **设备模拟测试**：使用模拟器进行自动化测试
- **API 测试**：验证 Web API 的正确性和稳定性
- **错误场景测试**：测试网络中断、设备离线等异常情况
- **模型响应测试**：验证 AI 模型的输出格式和逻辑正确性

### Git Workflow
- **主分支保护**：main 分支保持稳定，所有变更通过 PR 合并
- **功能分支**：使用 feature/ 前缀命名功能开发分支
- **提交信息规范**：使用中文描述，格式为"类型: 简短描述"
- **代码审查**：所有变更必须经过代码审查
- **自动测试**：CI/CD 流水线自动运行测试套件

## Domain Context

### 核心概念
- **PhoneAgent**：核心自动化引擎，负责理解指令和执行操作
- **视觉感知**：通过屏幕截图理解当前界面状态
- **动作规划**：AI 根据界面和任务生成具体操作步骤
- **设备控制**：通过 ADB 执行点击、滑动、输入等操作
- **脚本记录**：自动记录操作过程并生成可重放的自动化脚本
- **应用映射**：应用名称到 Android 包名的映射关系

### 工作流程
1. **用户输入**：自然语言任务描述（如"打开小红书搜索美食"）
2. **屏幕感知**：ADB 截图获取当前界面状态
3. **AI 理解**：视觉语言模型分析界面内容和任务需求
4. **动作规划**：生成具体的操作步骤（点击、滑动、输入等）
5. **执行操作**：通过 ADB 在设备上执行动作
6. **状态检查**：再次截图确认操作结果
7. **循环执行**：重复直到任务完成或出错

### 支持的应用类型
- **社交应用**：微信、QQ、微博、小红书
- **电商应用**：淘宝、京东、拼多多、抖音商城
- **视频应用**：抖音、快手、B站、西瓜视频
- **生活服务**：美团、饿了么、滴滴出行
- **工具应用**：支付宝、高德地图、WPS Office

## Important Constraints

### 技术约束
- **Android 设备要求**：必须开启 USB 调试模式和 ADB 授权
- **网络依赖**：AI 模型调用需要稳定的网络连接
- **屏幕分辨率**：目前主要针对主流手机分辨率优化
- **API 兼容性**：必须保持与 OpenAI API 格式的兼容性
- **内存限制**：图像处理和 AI 推理需要足够的内存资源

### 安全约束
- **敏感操作确认**：支付、删除等重要操作需要用户确认
- **人工接管**：登录、验证码等场景需要人工干预
- **数据隐私**：屏幕截图和操作日志的本地存储和传输安全
- **权限控制**：Android 设备的调试权限和 ADB 访问权限

### 业务约束
- **中文应用优化**：主要针对中文应用和中文用户需求
- **模型成本**：云端 AI 模型调用的成本控制和优化
- **用户体验**：操作成功率要求达到 85% 以上
- **响应时间**：单步操作响应时间控制在 10 秒以内

## External Dependencies

### 云服务依赖
- **智谱 AI BigModel**：https://open.bigmodel.cn/ - 主要 AI 模型服务
- **ModelScope**：https://modelscope.cn/ - 备选 AI 模型平台
- **Supabase**：https://supabase.co/ - 云端数据库和实时服务

### 系统依赖
- **Android SDK Platform Tools**：ADB 命令行工具
- **Python 3.10+**：运行时环境
- **现代浏览器**：Web 界面的客户端环境
- **Android 设备**：支持 USB 调试的 Android 5.0+ 设备

### 开发工具依赖
- **OpenSpec**：规格驱动开发工具和约定
- **Git**：版本控制系统
- **Docker**：容器化部署（可选）
- **vLLM/SGLang**：本地模型部署框架（可选）

### API 集成
- **OpenAI Compatible API**：标准化的 AI 模型接口
- **WebSocket API**：实时双向通信协议
- **RESTful API**：Web 服务接口
- **ADB Protocol**：Android 设备控制协议
